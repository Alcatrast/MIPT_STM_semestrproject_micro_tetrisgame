# MIPT_STM_semestrproject_micro_tetrisgame
–ø—Ä–æ–µ–∫—Ç  Tetris –¥–ª—è –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ stm32 –º—Ñ—Ç–∏ —Ñ–∞–∫—Ç 2 –∫—É—Ä—Å
# üéÆ Tetris –Ω–∞ STM32F401CCUx

![Tetris Game](image.png)

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–π –∏–≥—Ä—ã *–¢–µ—Ç—Ä–∏—Å* –Ω–∞ –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ **STM32F401CCUx** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¥–≤—É—Ö —Å–ø–æ—Å–æ–±–æ–≤ –≤–≤–æ–¥–∞ –∏ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º –¥–∏—Å–ø–ª–µ–µ–º **ST7735 (128√ó160)**.

> ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–Ω–æ–º–Ω–∞—è –≤–µ—Ä—Å–∏—è –±–µ–∑ –ü–ö ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –¥–∂–æ–π—Å—Ç–∏–∫ –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É  
> üïπÔ∏è –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏ –≤–≤–æ–¥–∞  
> ‚è±Ô∏è –ò–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –Ω–∞ —Ç–∞–π–º–µ—Ä–Ω—ã—Ö –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è—Ö

---

## üåü –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üïπÔ∏è **–î–≤–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤–≤–æ–¥–∞**:  
  - –ê–Ω–∞–ª–æ–≥–æ–≤—ã–π –¥–∂–æ–π—Å—Ç–∏–∫ (X/Y)  
  - –ú–∞—Ç—Ä–∏—á–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ 4√ó4
- üïí **–†–µ–≥—É–ª—è—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏** —á–µ—Ä–µ–∑ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è TIM10 (~15 –∫–∞–¥—Ä–æ–≤/—Å–µ–∫)
- üì∫ **–ì—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ ST7735**: –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø–æ–ª—è, —Ñ–∏–≥—É—Ä, —Å—á—ë—Ç–∞ –∏ —Å—Ç–∞—Ç—É—Å–∞
- üìä –ü–æ–¥—Å—á—ë—Ç –æ—á–∫–æ–≤ –∑–∞ —É–¥–∞–ª—ë–Ω–Ω—ã–µ –ª–∏–Ω–∏–∏
- üì± –ì–∏–±–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è ¬´–Ω–∞ –ª–µ—Ç—É¬ª (–∫–Ω–æ–ø–∫–∞ **S13**)
- üß† –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤—Å–µ 7 —Ñ–∏–≥—É—Ä –¢–µ—Ç—Ä–∏—Å–∞ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ —Ü–≤–µ—Ç–∞–º–∏

---

## üß† –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª—é—á–µ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### 1. üí° –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤–≤–æ–¥–∞

#### üéÆ –î–∂–æ–π—Å—Ç–∏–∫ (–∞–Ω–∞–ª–æ–≥–æ–≤—ã–π)
- **–ü–∏–Ω—ã**: `PA0` (X), `PA1` (Y)
- **–ê–¶–ü**: 12-–±–∏—Ç–Ω—ã–π, 2 –∫–∞–Ω–∞–ª–∞, –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ (Scan Mode)
- **–§—É–Ω–∫—Ü–∏–∏**:  
  - `read_joystick()` ‚Äî –∑–∞–ø—É—Å–∫ –∏ –æ–ø—Ä–æ—Å –ê–¶–ü  
  - `get_joystick_direction()` ‚Äî –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å ¬´–º—ë—Ä—Ç–≤–æ–π –∑–æ–Ω–æ–π¬ª (¬±600 –æ—Ç —Ü–µ–Ω—Ç—Ä–∞ 2048)
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
  | –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ | –£—Å–ª–æ–≤–∏–µ | –î–µ–π—Å—Ç–≤–∏–µ |
  |-------------|---------|----------|
  | ‚Üê –í–ª–µ–≤–æ | `X < 1448` | –°–¥–≤–∏–≥ —Ñ–∏–≥—É—Ä—ã –≤–ª–µ–≤–æ |
  | ‚Üí –í–ø—Ä–∞–≤–æ | `X > 2648` | –°–¥–≤–∏–≥ –≤–ø—Ä–∞–≤–æ |
  | ‚Üì –í–Ω–∏–∑ | `Y < 1448` | –û–¥–∏–Ω —à–∞–≥ –≤–Ω–∏–∑ |
  | ‚Üë –í–≤–µ—Ä—Ö | `Y > 2648` | –ü–æ–≤–æ—Ä–æ—Ç **–ø—Ä–æ—Ç–∏–≤** —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–∏ |
  | –ö–Ω–æ–ø–∫–∞ –Ω–∞ PA12 | –ù–∞–∂–∞—Ç–∞ | –ü–æ–≤–æ—Ä–æ—Ç **–ø–æ** —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ |

#### üî¢ –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ (–º–∞—Ç—Ä–∏—Ü–∞ 4√ó4)
- **–†—è–¥—ã (–≤—ã—Ö–æ–¥—ã)**: `PB6`, `PB7`, `PB8`, `PB9`
- **–°—Ç–æ–ª–±—Ü—ã (–≤—Ö–æ–¥—ã)**: `PB3`, `PB4`, `PB5`, `PA15` (—Å –ø–æ–¥—Ç—è–∂–∫–æ–π –≤–≤–µ—Ä—Ö)
- **–ê–Ω—Ç–∏–¥—Ä–µ–±–µ–∑–≥**: —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ —á–µ—Ä–µ–∑ —Ñ–ª–∞–≥–∏ `pr1`‚Äì`pr16`
- **–ö–∞—Ä—Ç–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:

| –ö–Ω–æ–ø–∫–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
|--------|----------|
| `S1` | –°–±—Ä–æ—Å –∏–≥—Ä—ã |
| `S3`, `S11` | –í–Ω–∏–∑ |
| `S5` | –ü–æ–≤–æ—Ä–æ—Ç –ø–æ —á–∞—Å–æ–≤–æ–π ‚§µÔ∏è |
| `S6` | –í–ª–µ–≤–æ |
| `S7` | –ù–æ–≤–∞—è –∏–≥—Ä–∞ (—Å—Ç–∞—Ä—Ç) |
| `S8` | –í–ø—Ä–∞–≤–æ |
| `S9` | –ü–æ–≤–æ—Ä–æ—Ç –ø—Ä–æ—Ç–∏–≤ —á–∞—Å–æ–≤–æ–π ‚§¥Ô∏è |
| `S13` | –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞: **–¥–∂–æ–π—Å—Ç–∏–∫ ‚áÑ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞** |

> üí° –í —Ä–µ–∂–∏–º–µ *–¥–∂–æ–π—Å—Ç–∏–∫–∞* –∫–ª–∞–≤–∏—à–∏ `S5`/`S9` **–∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è** ‚Äî –ø–æ–≤–æ—Ä–æ—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –æ—Å—å Y –∏ –∫–Ω–æ–ø–∫—É PA12.  
> –í —Ä–µ–∂–∏–º–µ *–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã* —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –∫–ª–∞–≤–∏—à–∞–º.

---

### 2. ‚è±Ô∏è –¢–∞–π–º–µ—Ä—ã –∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è

| –ú–æ–¥—É–ª—å | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|-----------|------------|
| **TIM10** | Prescaler = 8000, Period = 700 | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞–¥—Ä–æ–≤ (~15 –ì—Ü)<br>‚Üí `HAL_TIM_PeriodElapsedCallback()` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `update_flag = 1` |
| **ADC1** | 12 –±–∏—Ç, 2 –∫–∞–Ω–∞–ª–∞, Scan Mode | –û–ø—Ä–æ—Å –¥–∂–æ–π—Å—Ç–∏–∫–∞ |
| **DMA2_Stream0** | –ù–∞—Å—Ç—Ä–æ–µ–Ω | ‚Äî |

> üîÑ –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª:  
> ```c
> while (1) {
>   input();              // –û–ø—Ä–æ—Å –≤–≤–æ–¥–∞
>   if (update_flag) {    // –§–ª–∞–≥ –æ—Ç TIM10
>     update_flag = 0;
>     logic();            // –ü–∞–¥–µ–Ω–∏–µ —Ñ–∏–≥—É—Ä, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–Ω–∏–π
>     draw();             // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ —ç–∫—Ä–∞–Ω–∞
>   }
>   HAL_Delay(5);
> }
> ```

---

## üîå –°—Ö–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

| –ü–∏–Ω –ú–ö | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è |
|--------|-----------|------------|--------------|
| `PA0` | –î–∂–æ–π—Å—Ç–∏–∫ | –û—Å—å X | `ADC_IN0`, –∞–Ω–∞–ª–æ–≥–æ–≤—ã–π –≤—Ö–æ–¥ |
| `PA1` | –î–∂–æ–π—Å—Ç–∏–∫ | –û—Å—å Y | `ADC_IN1`, –∞–Ω–∞–ª–æ–≥–æ–≤—ã–π –≤—Ö–æ–¥ |
| `PA5` | ST7735 | SCK (SPI1) | –¢–∞–∫—Ç SPI |
| `PA7` | ST7735 | MOSI (SPI1) | –î–∞–Ω–Ω—ã–µ SPI |
| `PB6`‚Äì`PB9` | –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ | –†—è–¥—ã 1‚Äì4 | –í—ã—Ö–æ–¥—ã (push-pull) |
| `PB3`‚Äì`PB5`, `PA15` | –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ | –°—Ç–æ–ª–±—Ü—ã 1‚Äì4 | –í—Ö–æ–¥—ã —Å `GPIO_PULLUP` |
| `PA12` | –ö–Ω–æ–ø–∫–∞ | S13 (—Ä–µ–∂–∏–º) / –ø–æ–≤–æ—Ä–æ—Ç | –í—Ö–æ–¥ —Å `GPIO_PULLUP` (–∞–∫—Ç–∏–≤–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å ‚Äî **–Ω–∏–∑–∫–∏–π**) |
| `PC13` | ‚Äî | –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | –í—ã—Ö–æ–¥ (—Å–≤–µ—Ç–æ–¥–∏–æ–¥) |
| `PB0`‚Äì`PB2` | ‚Äî | –ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ | –í—ã—Ö–æ–¥—ã |

> ‚ö†Ô∏è –í—Å–µ –∫–Ω–æ–ø–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã **–º–µ–∂–¥—É –ø–∏–Ω–æ–º –∏ GND** ‚Üí –Ω–∞–∂–∞—Ç–∏–µ = `GPIO_PIN_RESET`.

---

## üïπÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã

| –°–æ—Å—Ç–æ—è–Ω–∏–µ | –≠–∫—Ä–∞–Ω | –î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è |
|-----------|-------|-------------------|
| **–ü–∞—É–∑–∞** | `Press START` | `S7` ‚Äî –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É |
| **–ò–≥—Ä–∞** | `Score: NNN`<br>`Mode: JOYSTICK / KEYPAD` | –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Ñ–∏–≥—É—Ä–æ–π |
| **–ü—Ä–æ–∏–≥—Ä—ã—à** | `Game Over!` | `S1` ‚Äî —Å–±—Ä–æ—Å, `S7` ‚Äî –Ω–æ–≤–∞—è –∏–≥—Ä–∞ |

---

## üõ†Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—é

- **–ú–ö**: STM32F401CCUx (–Ω–∞–ø—Ä–∏–º–µ—Ä, Nucleo-F401RE –∏–ª–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è –ø–ª–∞—Ç–∞)
- **–î–∏—Å–ø–ª–µ–π**: ST7735 (128√ó160, SPI)
- **–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞**: 4√ó4 –º–∞—Ç—Ä–∏—á–Ω–∞—è (16 –∫–Ω–æ–ø–æ–∫)
- **–î–∂–æ–π—Å—Ç–∏–∫**: –¥–≤—É—Ö–æ—Å–µ–≤–æ–π (2 –ø–æ—Ç–µ–Ω—Ü–∏–æ–º–µ—Ç—Ä–∞ + –∫–Ω–æ–ø–∫–∞, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- **–î–æ–ø. –∫–Ω–æ–ø–∫–∞**: –¥–ª—è –ø–æ–≤–æ—Ä–æ—Ç–∞ –ø–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ (PA12)

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
